/*!
 * FilePondPluginImageTransform 3.4.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const t={jpeg:"jpg","svg+xml":"svg"},e={1:()=>[1,0,0,1,0,0],2:t=>[-1,0,0,1,t,0],3:(t,e)=>[-1,0,0,-1,t,e],4:(t,e)=>[1,0,0,-1,0,e],5:()=>[0,1,1,0,0,0],6:(t,e)=>[0,1,-1,0,e,0],7:(t,e)=>[0,-1,-1,0,e,t],8:t=>[0,-1,1,0,0,t]},i=(t,e)=>({x:t,y:e}),n=(t,e)=>i(t.x-e.x,t.y-e.y),o=(t,e)=>Math.sqrt(((t,e)=>((t,e)=>t.x*e.x+t.y*e.y)(n(t,e),n(t,e)))(t,e)),r=(t,e)=>{const n=t,o=e,r=1.5707963267948966-e,a=Math.sin(1.5707963267948966),l=Math.sin(o),h=Math.sin(r),s=Math.cos(r),d=n/a;return i(s*(d*l),s*(d*h))},a=(t,e,n=0,a={x:.5,y:.5})=>{const l=a.x>.5?1-a.x:a.x,h=a.y>.5?1-a.y:a.y,s=2*l*t.width,d=2*h*t.height,c=((t,e)=>{const n=t.width,a=t.height,l=r(n,e),h=r(a,e),s=i(t.x+Math.abs(l.x),t.y-Math.abs(l.y)),d=i(t.x+t.width+Math.abs(h.y),t.y+Math.abs(h.x)),c=i(t.x-Math.abs(h.y),t.y+t.height-Math.abs(h.x));return{width:o(s,d),height:o(s,c)}})(e,n);return Math.max(c.width/s,c.height/d)},l=(t,e)=>{let i=t.width,n=i*e;return n>t.height&&(i=(n=t.height)/e),{x:.5*(t.width-i),y:.5*(t.height-n),width:i,height:n}},h=(t,e,i=1)=>{const n=t.height/t.width;let o=e,r=1,a=n;a>o&&(r=(a=o)/n);const l=Math.max(1/r,o/a),h=t.width/(i*l*r);return{width:h,height:h*e}},s=t=>t&&(t.horizontal||t.vertical),d=(t,i,n)=>{if(i<=1&&!s(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;const o=document.createElement("canvas"),r=t.naturalWidth,a=t.naturalHeight,l=i>=5&&i<=8;l?(o.width=a,o.height=r):(o.width=r,o.height=a);const h=o.getContext("2d");if(i&&h.transform.apply(h,((t,i,n)=>(-1===n&&(n=1),e[n](t,i)))(r,a,i)),s(n)){const t=[1,0,0,1,0,0];(!l&&n.horizontal||l&n.vertical)&&(t[0]=-1,t[4]=r),(!l&&n.vertical||l&&n.horizontal)&&(t[3]=-1,t[5]=a),h.transform(...t)}return h.drawImage(t,0,0,r,a),o};(()=>"undefined"!=typeof window&&void 0!==window.document)()&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){var n=this.toDataURL(e,i).split(",")[1];setTimeout(function(){for(var i=atob(n),o=i.length,r=new Uint8Array(o),a=0;a<o;a++)r[a]=i.charCodeAt(a);t(new Blob([r],{type:e||"image/png"}))})}}));const c=(t,e)=>y(t.x*e,t.y*e),g=(t,e)=>y(t.x+e.x,t.y+e.y),u=t=>{const e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:y(t.x/e,t.y/e)},m=(t,e,i)=>{const n=Math.cos(e),o=Math.sin(e),r=y(t.x-i.x,t.y-i.y);return y(i.x+n*r.x-o*r.y,i.y+o*r.x+n*r.y)},y=(t=0,e=0)=>({x:t,y:e}),p=(t,e,i=1,n)=>"string"==typeof t?parseFloat(t)*i:"number"==typeof t?t*(n?e[n]:Math.min(e.width,e.height)):void 0,f=(t,e,i)=>{const n=t.borderStyle||t.lineStyle||"solid",o=t.backgroundColor||t.fontColor||"transparent",r=t.borderColor||t.lineColor||"transparent",a=p(t.borderWidth||t.lineWidth,e,i);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof n?"":n.map(t=>p(t,e,i)).join(","),stroke:r,fill:o,opacity:t.opacity||1}},w=t=>null!=t,x=(t,e,i=1)=>{let n=p(t.x,e,i,"width")||p(t.left,e,i,"width"),o=p(t.y,e,i,"height")||p(t.top,e,i,"height"),r=p(t.width,e,i,"width"),a=p(t.height,e,i,"height"),l=p(t.right,e,i,"width"),h=p(t.bottom,e,i,"height");return w(o)||(o=w(a)&&w(h)?e.height-a-h:h),w(n)||(n=w(r)&&w(l)?e.width-r-l:l),w(r)||(r=w(n)&&w(l)?e.width-n-l:0),w(a)||(a=w(o)&&w(h)?e.height-o-h:0),{x:n||0,y:o||0,width:r||0,height:a||0}},M=(t,e)=>Object.keys(e).forEach(i=>t.setAttribute(i,e[i])),T=(t,e)=>{const i=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&M(i,e),i},A={contain:"xMidYMid meet",cover:"xMidYMid slice"},b={left:"start",center:"middle",right:"end"},v=t=>e=>T(t,{id:e.id}),E={image:t=>{const e=T("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=(()=>{e.setAttribute("opacity",t.opacity||1)}),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:v("rect"),ellipse:v("ellipse"),text:v("text"),line:t=>{const e=T("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),i=T("line");e.appendChild(i);const n=T("path");e.appendChild(n);const o=T("path");return e.appendChild(o),e}},R={rect:t=>M(t,{...t.rect,...t.styles}),ellipse:t=>{const e=t.rect.x+.5*t.rect.width,i=t.rect.y+.5*t.rect.height,n=.5*t.rect.width,o=.5*t.rect.height;return M(t,{cx:e,cy:i,rx:n,ry:o,...t.styles})},image:(t,e)=>{M(t,{...t.rect,...t.styles,preserveAspectRatio:A[e.fit]||"none"})},text:(t,e,i,n)=>{const o=p(e.fontSize,i,n),r=e.fontFamily||"sans-serif",a=e.fontWeight||"normal",l=b[e.textAlign]||"start";M(t,{...t.rect,...t.styles,"stroke-width":0,"font-weight":a,"font-size":o,"font-family":r,"text-anchor":l}),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},line:(t,e,i,n)=>{M(t,{...t.rect,...t.styles,fill:"none"});const o=t.childNodes[0],r=t.childNodes[1],a=t.childNodes[2],l=t.rect,h={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(M(o,{x1:l.x,y1:l.y,x2:h.x,y2:h.y}),!e.lineDecoration)return;r.style.display="none",a.style.display="none";const s=u({x:h.x-l.x,y:h.y-l.y}),d=p(.05,i,n);if(-1!==e.lineDecoration.indexOf("arrow-begin")){const t=c(s,d),e=g(l,t),i=m(l,2,e),n=m(l,-2,e);M(r,{style:"display:block;",d:`M${i.x},${i.y} L${l.x},${l.y} L${n.x},${n.y}`})}if(-1!==e.lineDecoration.indexOf("arrow-end")){const t=c(s,-d),e=g(h,t),i=m(h,2,e),n=m(h,-2,e);M(a,{style:"display:block;",d:`M${i.x},${i.y} L${h.x},${h.y} L${n.x},${n.y}`})}}},_=(t,e)=>t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0,I=(t,e,i)=>new Promise(n=>{const o=new FileReader;o.onloadend=(()=>{const t=o.result,r=document.createElement("div");r.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",r.innerHTML=t;const h=r.querySelector("svg");document.body.appendChild(r);const s=h.getBBox();r.parentNode.removeChild(r);const d=r.querySelector("title"),c=h.getAttribute("viewBox")||"",g=h.getAttribute("width")||"",u=h.getAttribute("height")||"";let m=parseFloat(g)||null,y=parseFloat(u)||null;const p=(g.match(/[a-z]+/)||[])[0]||"",w=(u.match(/[a-z]+/)||[])[0]||"",M=c.split(" ").map(parseFloat),T=M.length?{x:M[0],y:M[1],width:M[2],height:M[3]}:s;let A=null!=m?m:T.width,b=null!=y?y:T.height;h.style.overflow="visible",h.setAttribute("width",A),h.setAttribute("height",b);let v="";if(i&&i.length){const t={width:A,height:b};v=`\n\n<g>${(v=i.sort(_).reduce((e,i)=>{const n=((t,e)=>E[t](e))(i[0],i[1]);return((t,e,i,n,o)=>{t.rect=x(i,n,o),t.styles=f(i,n,o),R[e](t,i,n,o)})(n,i[0],i[1],t),n.removeAttribute("id"),1===n.getAttribute("opacity")&&n.removeAttribute("opacity"),e+"\n"+n.outerHTML+"\n"},"")).replace(/&nbsp;/g," ")}</g>\n\n`}const I=e.aspectRatio||b/A,O=A,N=O*I,C=a({width:A,height:b},l({width:O,height:N},I),e.rotation,e.center),L=e.zoom*C,S=.5*O,B=.5*N,U=[`rotate(${e.rotation*(180/Math.PI)} ${S} ${B})`,`translate(${S} ${B})`,`scale(${L})`,`translate(${-S} ${-B})`,`translate(${S-A*e.center.x} ${B-b*e.center.y})`],$=[`scale(${e.flip.horizontal?-1:1} ${e.flip.vertical?-1:1})`,`translate(${e.flip.horizontal?-A:0} ${e.flip.vertical?-b:0})`],P=`<?xml version="1.0" encoding="UTF-8"?>\n<svg width="${O}${p}" height="${N}${w}" \nviewBox="0 0 ${O} ${N}" \npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>${d?d.textContent:""}</title>\n<g transform="${U.join(" ")}">\n<g transform="${$.join(" ")}">\n${h.outerHTML}${v}\n</g>\n</g>\n</svg>`;n(P)}),o.readAsText(t)}),O=()=>{const t={resize:function(t,e){let{mode:n="contain",upscale:a=!1,width:l,height:h,matrix:s}=e;if(s=!s||o(s)?null:s,!l&&!h)return r(t,s);null===l?l=h:null===h&&(h=l);if("force"!==n){let e=l/t.width,i=h/t.height,o=1;if("cover"===n?o=Math.max(e,i):"contain"===n&&(o=Math.min(e,i)),o>1&&!1===a)return r(t,s);l=t.width*o,h=t.height*o}const d=t.width,c=t.height,g=Math.round(l),u=Math.round(h),m=t.data,y=new Uint8ClampedArray(g*u*4),p=d/g,f=c/u,w=Math.ceil(.5*p),x=Math.ceil(.5*f);for(let t=0;t<u;t++)for(let e=0;e<g;e++){let n=4*(e+t*g),o=0,r=0,a=0,l=0,h=0,c=0,u=0,M=(t+.5)*f;for(let i=Math.floor(t*f);i<(t+1)*f;i++){let t=Math.abs(M-(i+.5))/x,n=(e+.5)*p,s=t*t;for(let t=Math.floor(e*p);t<(e+1)*p;t++){let e=Math.abs(n-(t+.5))/w,g=Math.sqrt(s+e*e);if(g>=-1&&g<=1&&(o=2*g*g*g-3*g*g+1)>0){let n=m[(e=4*(t+i*d))+3];u+=o*n,a+=o,n<255&&(o=o*n/250),l+=o*m[e],h+=o*m[e+1],c+=o*m[e+2],r+=o}}}y[n]=l/r,y[n+1]=h/r,y[n+2]=c/r,y[n+3]=u/a,s&&i(n,y,s)}return{data:y,width:g,height:u}},filter:r},e=(e,i)=>{let n=e.transforms,o=null;if(n.forEach(t=>{"filter"===t.type&&(o=t)}),o){let t=null;n.forEach(e=>{"resize"===e.type&&(t=e)}),t&&(t.data.matrix=o.data,n=n.filter(t=>"filter"!==t.type))}i(((e,i)=>(e.forEach(e=>{i=t[e.type](i,e.data)}),i))(n,e.imageData))};function i(t,e,i){let n=0,o=0,r=0,a=e[t]/255,l=e[t+1]/255,h=e[t+2]/255,s=e[t+3]/255;for(;n<4;n++)r=255*(a*i[o=5*n]+l*i[o+1]+h*i[o+2]+s*i[o+3]+i[o+4]),e[t+n]=Math.max(0,Math.min(r,255))}self.onmessage=(t=>{e(t.data.message,e=>{self.postMessage({id:t.data.id,message:e},[e.data.buffer])})});const n=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function o(t){return self.JSON.stringify(t||[])===n}function r(t,e){if(!e||o(e))return t;const i=t.data,n=i.length,r=e[0],a=e[1],l=e[2],h=e[3],s=e[4],d=e[5],c=e[6],g=e[7],u=e[8],m=e[9],y=e[10],p=e[11],f=e[12],w=e[13],x=e[14],M=e[15],T=e[16],A=e[17],b=e[18],v=e[19];let E=0,R=0,_=0,I=0,O=0;for(;E<n;E+=4)R=i[E]/255,_=i[E+1]/255,I=i[E+2]/255,O=i[E+3]/255,i[E]=Math.max(0,Math.min(255*(R*r+_*a+I*l+O*h+s),255)),i[E+1]=Math.max(0,Math.min(255*(R*d+_*c+I*g+O*u+m),255)),i[E+2]=Math.max(0,Math.min(255*(R*y+_*p+I*f+O*w+x),255)),i[E+3]=Math.max(0,Math.min(255*(R*M+_*T+I*A+O*b+v),255));return t}},N=(t,e,i)=>{if(1165519206!==t.getUint32(e+4,!1))return;e+=4;const n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);const o=t.getUint16(e,n);e+=2;for(let i=0;i<o;i++)if(274===t.getUint16(e+12*i,n))return t.setUint16(e+12*i+8,1,n),!0;return!1},C=t=>new Promise((e,i)=>{const n=new FileReader;n.onload=(()=>e((t=>{const e=new DataView(t);if(65496!==e.getUint16(0))return null;let i,n,o=2,r=!1;for(;o<e.byteLength&&(i=e.getUint16(o,!1),n=e.getUint16(o+2,!1)+2,i>=65504&&i<=65519||65534===i)&&(r||(r=N(e,o)),!(o+n>e.byteLength));)o+=n;return t.slice(0,o)})(n.result)||null)),n.readAsArrayBuffer(t.slice(0,262144))}),L=(t,e)=>{const i=(()=>window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)();if(i){const n=new i;return n.append(t),n.getBlob(e)}return new Blob([t],{type:e})},S=t=>{const e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),i=URL.createObjectURL(e),n=new Worker(i);return{transfer:(t,e)=>{},post:(t,e,i)=>{const o=(()=>Math.random().toString(36).substr(2,9))();n.onmessage=(t=>{t.data.id===o&&e(t.data.message)}),n.postMessage({id:o,message:t},i)},terminate:()=>{n.terminate(),URL.revokeObjectURL(i)}}},B=(t,e)=>new Promise(i=>{const n={width:t.width,height:t.height},o=t.getContext("2d");(t=>t.reduce((t,e)=>t.then(t=>e().then(Array.prototype.concat.bind(t))),Promise.resolve([])))(e.sort(_).map(t=>()=>new Promise(e=>{P[t[0]](o,n,t[1],e)&&e()}))).then(()=>i(t))}),U=(t,e)=>{t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},$=t=>{t.fill(),t.stroke(),t.globalAlpha=1},P={rect:(t,e,i)=>{const n=x(i,e),o=f(i,e);return U(t,o),t.rect(n.x,n.y,n.width,n.height),$(t),!0},ellipse:(t,e,i)=>{const n=x(i,e),o=f(i,e);U(t,o);const r=n.x,a=n.y,l=n.width,h=n.height,s=l/2*.5522848,d=h/2*.5522848,c=r+l,g=a+h,u=r+l/2,m=a+h/2;return t.moveTo(r,m),t.bezierCurveTo(r,m-d,u-s,a,u,a),t.bezierCurveTo(u+s,a,c,m-d,c,m),t.bezierCurveTo(c,m+d,u+s,g,u,g),t.bezierCurveTo(u-s,g,r,m+d,r,m),$(t),!0},image:(t,e,i,n)=>{const o=x(i,e),r=f(i,e);U(t,r);const a=new Image;a.onload=(()=>{if("cover"===i.fit){const e=o.width/o.height,i=e>1?a.width:a.height*e,n=e>1?a.width/e:a.height,r=.5*a.width-.5*i,l=.5*a.height-.5*n;t.drawImage(a,r,l,i,n,o.x,o.y,o.width,o.height)}else if("contain"===i.fit){const e=Math.min(o.width/a.width,o.height/a.height),i=e*a.width,n=e*a.height,r=o.x+.5*o.width-.5*i,l=o.y+.5*o.height-.5*n;t.drawImage(a,0,0,a.width,a.height,r,l,i,n)}else t.drawImage(a,0,0,a.width,a.height,o.x,o.y,o.width,o.height);$(t),n()}),a.src=i.src},text:(t,e,i)=>{const n=x(i,e),o=f(i,e);U(t,o);const r=p(i.fontSize,e),a=i.fontFamily||"sans-serif",l=i.fontWeight||"normal",h=i.textAlign||"left";return t.font=`${l} ${r}px ${a}`,t.textAlign=h,t.fillText(i.text,n.x,n.y),$(t),!0},line:(t,e,i)=>{const n=x(i,e),o=f(i,e);U(t,o),t.beginPath();const r={x:n.x,y:n.y},a={x:n.x+n.width,y:n.y+n.height};t.moveTo(r.x,r.y),t.lineTo(a.x,a.y);const l=u({x:a.x-r.x,y:a.y-r.y}),h=.04*Math.min(e.width,e.height);if(-1!==i.lineDecoration.indexOf("arrow-begin")){const e=c(l,h),i=g(r,e),n=m(r,2,i),o=m(r,-2,i);t.moveTo(n.x,n.y),t.lineTo(r.x,r.y),t.lineTo(o.x,o.y)}if(-1!==i.lineDecoration.indexOf("arrow-end")){const e=c(l,-h),i=g(a,e),n=m(a,2,i),o=m(a,-2,i);t.moveTo(n.x,n.y),t.lineTo(a.x,a.y),t.lineTo(o.x,o.y)}return $(t),!0}},F=(t,e,i={})=>new Promise((n,o)=>{if(!t||!(t=>/^image/.test(t.type))(t))return o();const{stripImageHead:r,beforeCreateBlob:s,afterCreateBlob:c,canvasMemoryLimit:g}=i,{crop:u,size:m,filter:y,markup:p,output:f}=e,w=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,x=f&&f.quality,M=null===x?null:x/100,T=f&&f.type||null,A=[];!m||"number"!=typeof m.width&&"number"!=typeof m.height||A.push({type:"resize",data:m}),y&&20===y.length&&A.push({type:"filter",data:y});const b=t=>{const e=c?c(t):t;Promise.resolve(e).then(n)},v=(t,e)=>{const i=(t=>{const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e})(t),n=p.length?B(i,p):i;Promise.resolve(n).then(t=>{((t,e,i=null)=>new Promise(n=>{const o=i?i(t):t;Promise.resolve(o).then(t=>{t.toBlob(n,e.type,e.quality)})}))(t,e,s).then(t=>{if(r)return b(t);C(t).then(e=>{null!==e&&(t=new Blob([e,t.slice(20)],{type:t.type})),b(t)})}).catch(o)})};if(/svg/.test(t.type)&&null===T)return I(t,u,p).then(t=>{n(L(t,"image/svg+xml"))});const E=URL.createObjectURL(t);(t=>new Promise((e,i)=>{const n=new Image;n.onload=(()=>{e(n)}),n.onerror=(t=>{i(t)}),n.src=t}))(E).then(e=>{URL.revokeObjectURL(E);const i=((t,e,i={},n={})=>{const{canvasMemoryLimit:o}=n,r=i.zoom||1,s=d(t,e,i.flip),c={width:s.width,height:s.height},g=i.aspectRatio||c.height/c.width;let u=h(c,g,r);if(o){const t=u.width*u.height;if(t>o){const e=Math.sqrt(o)/Math.sqrt(t);c.width=Math.floor(c.width*e),c.height=Math.floor(c.height*e),u=h(c,g,r)}}const m=document.createElement("canvas"),y={x:.5*u.width,y:.5*u.height},p={x:0,y:0,width:u.width,height:u.height,center:y},f=r*a(c,l(p,g),i.rotation,i.center);m.width=Math.round(u.width/f),m.height=Math.round(u.height/f),y.x/=f,y.y/=f;const w=y.x-c.width*(i.center?i.center.x:.5),x=y.y-c.height*(i.center?i.center.y:.5),M=m.getContext("2d");return M.translate(y.x,y.y),M.rotate(i.rotation||0),M.drawImage(s,w-y.x,x-y.y,c.width,c.height),M.getImageData(0,0,m.width,m.height)})(e,w,u,{canvasMemoryLimit:g}),n={quality:M,type:T||t.type};if(!A.length)return v(i,n);const o=S(O);o.post({transforms:A,imageData:i},t=>{v((t=>{let e;try{e=new ImageData(t.width,t.height)}catch(i){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e})(t),n),o.terminate()},[i.data.buffer])})}),G=["x","y","left","top","right","bottom","width","height"],z=t=>{const[e,i]=t;return[e,{zIndex:0,...i,...G.reduce((t,e)=>(t[e]=(t=>"string"==typeof t&&/%/.test(t)?parseFloat(t)/100:t)(i[e]),t),{})}]};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){const n=this;setTimeout(()=>{const o=n.toDataURL(e,i).split(",")[1],r=atob(o);let a=r.length;const l=new Uint8Array(a);for(;a--;)l[a]=r.charCodeAt(a);t(new Blob([l],{type:e||"image/png"}))})}}));const k="undefined"!=typeof window&&void 0!==window.document,D=k&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,j=({addFilter:e,utils:i})=>{const{Type:n,forin:o,getFileFromBlob:r,isFile:a}=i,l=["crop","resize","filter","markup","output"],h=t=>null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical;return e("SHOULD_PREPARE_OUTPUT",(t,{query:e})=>new Promise(t=>{t(!e("IS_ASYNC"))})),e("PREPARE_OUTPUT",(e,{query:i,item:n})=>new Promise(s=>{if(!a(e)||!(t=>/^image/.test(t.type))(e)||!i("GET_ALLOW_IMAGE_TRANSFORM")||n.archived)return s(e);const d=[];i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&d.push(()=>new Promise(t=>{t({name:i("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:e})})),i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&d.push((t,e,n)=>new Promise(o=>{t(e,n).then(t=>o({name:i("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t}))}));const c=i("GET_IMAGE_TRANSFORM_VARIANTS")||{};o(c,(t,e)=>{const i=(t=>(e,i,n)=>e(i,t?t(n):n))(e);d.push((e,n,o)=>new Promise(r=>{i(e,n,o).then(e=>r({name:t,file:e}))}))});const g=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),u=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),m=null===g?null:g/100,y=i("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),p=i("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||l;n.setMetadata("output",{type:y,quality:m,client:p},!0);const f=(e,n)=>new Promise((o,a)=>{const l={...n};Object.keys(l).filter(t=>"exif"!==t).forEach(t=>{-1===p.indexOf(t)&&delete l[t]});const{resize:s,exif:d,output:c,crop:g,filter:m,markup:y}=l,f={image:{orientation:d?d.orientation:null},output:c?{type:c.type,quality:c.quality?100*c.quality:null}:void 0,size:s&&(s.size.width||s.size.height)?{mode:s.mode,upscale:s.upscale,...s.size}:void 0,crop:g&&!h(g)?{...g}:void 0,markup:y&&y.length?y.map(z):[],filter:m};if(f.output){const t=c.type&&c.type!==e.type,i=!!(f.size||f.crop||f.filter||t);if(c.quality&&"optional"===u&&!i)return o(e)}const w={beforeCreateBlob:i("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:i("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:i("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:i("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};F(e,f,w).then(i=>{const n=r(i,((e,i)=>{const n=(t=>t.substr(0,t.lastIndexOf("."))||t)(e),o=i.split("/")[1];return`${n}.${t[o]||o}`})(e.name,(t=>/jpeg|png|svg\+xml/.test(t)?t:"image/jpeg")(i.type)));o(n)}).catch(a)}),w=d.map(t=>t(f,e,n.getMetadata()));Promise.all(w).then(t=>{s(1===t.length&&null===t[0].name?t[0].file:t)})})),{options:{allowImageTransform:[!0,n.BOOLEAN],imageTransformOutputMimeType:[null,n.STRING],imageTransformOutputQuality:[null,n.INT],imageTransformOutputStripImageHead:[!0,n.BOOLEAN],imageTransformClientTransforms:[null,n.ARRAY],imageTransformOutputQualityMode:["always",n.STRING],imageTransformVariants:[null,n.OBJECT],imageTransformVariantsIncludeDefault:[!0,n.BOOLEAN],imageTransformVariantsDefaultName:[null,n.STRING],imageTransformVariantsIncludeOriginal:[!1,n.BOOLEAN],imageTransformVariantsOriginalName:["original_",n.STRING],imageTransformBeforeCreateBlob:[null,n.FUNCTION],imageTransformAfterCreateBlob:[null,n.FUNCTION],imageTransformCanvasMemoryLimit:[k&&D?16777216:null,n.INT]}}};k&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:j}));export default j;
