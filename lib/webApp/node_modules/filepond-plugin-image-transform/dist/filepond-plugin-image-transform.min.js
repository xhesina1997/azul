/*!
 * FilePondPluginImageTransform 3.4.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).FilePondPluginImageTransform=e()}(this,function(){"use strict";var t={jpeg:"jpg","svg+xml":"svg"},e={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},n=function(t,e){return{x:t,y:e}},i=function(t,e){return n(t.x-e.x,t.y-e.y)},r=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(i(t,e),i(t,e))}(t,e))},o=function(t,e){var i=t,r=e,o=1.5707963267948966-e,a=Math.sin(1.5707963267948966),u=Math.sin(r),c=Math.sin(o),h=Math.cos(o),l=i/a;return n(h*(l*u),h*(l*c))},a=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},u=a.x>.5?1-a.x:a.x,c=a.y>.5?1-a.y:a.y,h=2*u*t.width,l=2*c*t.height,f=function(t,e){var i=t.width,a=t.height,u=o(i,e),c=o(a,e),h=n(t.x+Math.abs(u.x),t.y-Math.abs(u.y)),l=n(t.x+t.width+Math.abs(c.y),t.y+Math.abs(c.x)),f=n(t.x-Math.abs(c.y),t.y+t.height-Math.abs(c.x));return{width:r(h,l),height:r(h,f)}}(e,i);return Math.max(f.width/h,f.height/l)},u=function(t,e){var n=t.width,i=n*e;return i>t.height&&(n=(i=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},c=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.height/t.width,r=e,o=1,a=i;a>r&&(o=(a=r)/i);var u=Math.max(1/o,r/a),c=t.width/(n*u*o);return{width:c,height:c*e}},h=function(t){return t&&(t.horizontal||t.vertical)},l=function(t,n,i){if(n<=1&&!h(i))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),o=t.naturalWidth,a=t.naturalHeight,u=n>=5&&n<=8;u?(r.width=a,r.height=o):(r.width=o,r.height=a);var c=r.getContext("2d");if(n&&c.transform.apply(c,function(t,n,i){return-1===i&&(i=1),e[i](t,n)}(o,a,n)),h(i)){var l=[1,0,0,1,0,0];(!u&&i.horizontal||u&i.vertical)&&(l[0]=-1,l[4]=o),(!u&&i.vertical||u&&i.horizontal)&&(l[3]=-1,l[5]=a),c.transform.apply(c,l)}return c.drawImage(t,0,0,o,a),r};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(i),r=n.length,o=new Uint8Array(r),a=0;a<r;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))})}}));var f=function(t,e){return y(t.x*e,t.y*e)},s=function(t,e){return y(t.x+e.x,t.y+e.y)},d=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:y(t.x/e,t.y/e)},g=function(t,e,n){var i=Math.cos(e),r=Math.sin(e),o=y(t.x-n.x,t.y-n.y);return y(n.x+i*o.x-r*o.y,n.y+r*o.x+i*o.y)},y=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},v=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*n:"number"==typeof t?t*(i?e[i]:Math.min(e.width,e.height)):void 0},m=function(t,e,n){var i=t.borderStyle||t.lineStyle||"solid",r=t.backgroundColor||t.fontColor||"transparent",o=t.borderColor||t.lineColor||"transparent",a=v(t.borderWidth||t.lineWidth,e,n);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof i?"":i.map(function(t){return v(t,e,n)}).join(","),stroke:o,fill:r,opacity:t.opacity||1}},p=function(t){return null!=t},w=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=v(t.x,e,n,"width")||v(t.left,e,n,"width"),r=v(t.y,e,n,"height")||v(t.top,e,n,"height"),o=v(t.width,e,n,"width"),a=v(t.height,e,n,"height"),u=v(t.right,e,n,"width"),c=v(t.bottom,e,n,"height");return p(r)||(r=p(a)&&p(c)?e.height-a-c:c),p(i)||(i=p(o)&&p(u)?e.width-o-u:u),p(o)||(o=p(i)&&p(u)?e.width-i-u:0),p(a)||(a=p(r)&&p(c)?e.height-r-c:0),{x:i||0,y:r||0,width:o||0,height:a||0}},x=function(t,e){return Object.keys(e).forEach(function(n){return t.setAttribute(n,e[n])})},M=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&x(n,e),n},T={contain:"xMidYMid meet",cover:"xMidYMid slice"},b={left:"start",center:"middle",right:"end"},A=function(t){return function(e){return M(t,{id:e.id})}},E={image:function(t){var e=M("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=function(){e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:A("rect"),ellipse:A("ellipse"),text:A("text"),line:function(t){var e=M("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=M("line");e.appendChild(n);var i=M("path");e.appendChild(i);var r=M("path");return e.appendChild(r),e}},_={rect:function(t){return x(t,Object.assign({},t.rect,t.styles))},ellipse:function(t){var e=t.rect.x+.5*t.rect.width,n=t.rect.y+.5*t.rect.height,i=.5*t.rect.width,r=.5*t.rect.height;return x(t,Object.assign({cx:e,cy:n,rx:i,ry:r},t.styles))},image:function(t,e){x(t,Object.assign({},t.rect,t.styles,{preserveAspectRatio:T[e.fit]||"none"}))},text:function(t,e,n,i){var r=v(e.fontSize,n,i),o=e.fontFamily||"sans-serif",a=e.fontWeight||"normal",u=b[e.textAlign]||"start";x(t,Object.assign({},t.rect,t.styles,{"stroke-width":0,"font-weight":a,"font-size":r,"font-family":o,"text-anchor":u})),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},line:function(t,e,n,i){x(t,Object.assign({},t.rect,t.styles,{fill:"none"}));var r=t.childNodes[0],o=t.childNodes[1],a=t.childNodes[2],u=t.rect,c={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(x(r,{x1:u.x,y1:u.y,x2:c.x,y2:c.y}),e.lineDecoration){o.style.display="none",a.style.display="none";var h=d({x:c.x-u.x,y:c.y-u.y}),l=v(.05,n,i);if(-1!==e.lineDecoration.indexOf("arrow-begin")){var y=f(h,l),m=s(u,y),p=g(u,2,m),w=g(u,-2,m);x(o,{style:"display:block;",d:"M".concat(p.x,",").concat(p.y," L").concat(u.x,",").concat(u.y," L").concat(w.x,",").concat(w.y)})}if(-1!==e.lineDecoration.indexOf("arrow-end")){var M=f(h,-l),T=s(c,M),b=g(c,2,T),A=g(c,-2,T);x(a,{style:"display:block;",d:"M".concat(b.x,",").concat(b.y," L").concat(c.x,",").concat(c.y," L").concat(A.x,",").concat(A.y)})}}}},O=function(t,e){return t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0},I=function(t,e,n){return new Promise(function(i){var r=new FileReader;r.onloadend=function(){var t=r.result,o=document.createElement("div");o.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",o.innerHTML=t;var c=o.querySelector("svg");document.body.appendChild(o);var h=c.getBBox();o.parentNode.removeChild(o);var l=o.querySelector("title"),f=c.getAttribute("viewBox")||"",s=c.getAttribute("width")||"",d=c.getAttribute("height")||"",g=parseFloat(s)||null,y=parseFloat(d)||null,v=(s.match(/[a-z]+/)||[])[0]||"",p=(d.match(/[a-z]+/)||[])[0]||"",x=f.split(" ").map(parseFloat),M=x.length?{x:x[0],y:x[1],width:x[2],height:x[3]}:h,T=null!=g?g:M.width,b=null!=y?y:M.height;c.style.overflow="visible",c.setAttribute("width",T),c.setAttribute("height",b);var A="";if(n&&n.length){var I={width:T,height:b};A=n.sort(O).reduce(function(t,e){var n,i,r=(n=e[0],i=e[1],E[n](i));return function(t,e,n,i,r){t.rect=w(n,i,r),t.styles=m(n,i,r),_[e](t,n,i,r)}(r,e[0],e[1],I),r.removeAttribute("id"),1===r.getAttribute("opacity")&&r.removeAttribute("opacity"),t+"\n"+r.outerHTML+"\n"},""),A="\n\n<g>".concat(A.replace(/&nbsp;/g," "),"</g>\n\n")}var R=e.aspectRatio||b/T,N=T,S=N*R,C=a({width:T,height:b},u({width:N,height:S},R),e.rotation,e.center),L=e.zoom*C,B=e.rotation*(180/Math.PI),P={x:.5*N,y:.5*S},U={x:P.x-T*e.center.x,y:P.y-b*e.center.y},k=["rotate(".concat(B," ").concat(P.x," ").concat(P.y,")"),"translate(".concat(P.x," ").concat(P.y,")"),"scale(".concat(L,")"),"translate(".concat(-P.x," ").concat(-P.y,")"),"translate(".concat(U.x," ").concat(U.y,")")],F=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-T:0," ").concat(e.flip.vertical?-b:0,")")],G='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(N).concat(v,'" height="').concat(S).concat(p,'" \nviewBox="0 0 ').concat(N," ").concat(S,'" \npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>').concat(l?l.textContent:"",'</title>\n<g transform="').concat(k.join(" "),'">\n<g transform="').concat(F.join(" "),'">\n').concat(c.outerHTML).concat(A,"\n</g>\n</g>\n</svg>");i(G)},r.readAsText(t)})},R=function(){var t={resize:function(t,e){var i=e.mode,a=void 0===i?"contain":i,u=e.upscale,c=void 0!==u&&u,h=e.width,l=e.height,f=e.matrix;if(f=!f||r(f)?null:f,!h&&!l)return o(t,f);null===h?h=l:null===l&&(l=h);if("force"!==a){var s=h/t.width,d=l/t.height,g=1;if("cover"===a?g=Math.max(s,d):"contain"===a&&(g=Math.min(s,d)),g>1&&!1===c)return o(t,f);h=t.width*g,l=t.height*g}for(var y=t.width,v=t.height,m=Math.round(h),p=Math.round(l),w=t.data,x=new Uint8ClampedArray(m*p*4),M=y/m,T=v/p,b=Math.ceil(.5*M),A=Math.ceil(.5*T),E=0;E<p;E++)for(var _=0;_<m;_++){for(var O=4*(_+E*m),I=0,R=0,N=0,S=0,C=0,L=0,B=0,P=(E+.5)*T,U=Math.floor(E*T);U<(E+1)*T;U++)for(var k=Math.abs(P-(U+.5))/A,F=(_+.5)*M,G=k*k,z=Math.floor(_*M);z<(_+1)*M;z++){var j=Math.abs(F-(z+.5))/b,D=Math.sqrt(G+j*j);if(D>=-1&&D<=1&&(I=2*D*D*D-3*D*D+1)>0){var q=w[(j=4*(z+U*y))+3];B+=I*q,N+=I,q<255&&(I=I*q/250),S+=I*w[j],C+=I*w[j+1],L+=I*w[j+2],R+=I}}x[O]=S/R,x[O+1]=C/R,x[O+2]=L/R,x[O+3]=B/N,f&&n(O,x,f)}return{data:x,width:m,height:p}},filter:o},e=function(e,n){var i=e.transforms,r=null;if(i.forEach(function(t){"filter"===t.type&&(r=t)}),r){var o=null;i.forEach(function(t){"resize"===t.type&&(o=t)}),o&&(o.data.matrix=r.data,i=i.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(i,e.imageData))};function n(t,e,n){for(var i=0,r=0,o=0,a=e[t]/255,u=e[t+1]/255,c=e[t+2]/255,h=e[t+3]/255;i<4;i++)o=255*(a*n[r=5*i]+u*n[r+1]+c*n[r+2]+h*n[r+3]+n[r+4]),e[t+i]=Math.max(0,Math.min(o,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var i=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function r(t){return self.JSON.stringify(t||[])===i}function o(t,e){if(!e||r(e))return t;for(var n=t.data,i=n.length,o=e[0],a=e[1],u=e[2],c=e[3],h=e[4],l=e[5],f=e[6],s=e[7],d=e[8],g=e[9],y=e[10],v=e[11],m=e[12],p=e[13],w=e[14],x=e[15],M=e[16],T=e[17],b=e[18],A=e[19],E=0,_=0,O=0,I=0,R=0;E<i;E+=4)_=n[E]/255,O=n[E+1]/255,I=n[E+2]/255,R=n[E+3]/255,n[E]=Math.max(0,Math.min(255*(_*o+O*a+I*u+R*c+h),255)),n[E+1]=Math.max(0,Math.min(255*(_*l+O*f+I*s+R*d+g),255)),n[E+2]=Math.max(0,Math.min(255*(_*y+O*v+I*m+R*p+w),255)),n[E+3]=Math.max(0,Math.min(255*(_*x+O*M+I*T+R*b+A),255));return t}},N=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var i=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,i);var r=t.getUint16(e,i);e+=2;for(var o=0;o<r;o++)if(274===t.getUint16(e+12*o,i))return t.setUint16(e+12*o+8,1,i),!0;return!1}},S=function(t){return new Promise(function(e,n){var i=new FileReader;i.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,i,r=2,o=!1;r<e.byteLength&&(n=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=N(e,r)),!(r+i>e.byteLength));)r+=i;return t.slice(0,r)}(i.result)||null)},i.readAsArrayBuffer(t.slice(0,262144))})},C=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},L=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var r=Math.random().toString(36).substr(2,9);i.onmessage=function(t){t.data.id===r&&e(t.data.message)},i.postMessage({id:r,message:t},n)},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}},B=function(t,e){return new Promise(function(n){var i,r={width:t.width,height:t.height},o=t.getContext("2d"),a=e.sort(O).map(function(t){return function(){return new Promise(function(e){k[t[0]](o,r,t[1],e)&&e()})}});(i=a,i.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))).then(function(){return n(t)})})},P=function(t,e){t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},U=function(t){t.fill(),t.stroke(),t.globalAlpha=1},k={rect:function(t,e,n){var i=w(n,e),r=m(n,e);return P(t,r),t.rect(i.x,i.y,i.width,i.height),U(t),!0},ellipse:function(t,e,n){var i=w(n,e),r=m(n,e);P(t,r);var o=i.x,a=i.y,u=i.width,c=i.height,h=u/2*.5522848,l=c/2*.5522848,f=o+u,s=a+c,d=o+u/2,g=a+c/2;return t.moveTo(o,g),t.bezierCurveTo(o,g-l,d-h,a,d,a),t.bezierCurveTo(d+h,a,f,g-l,f,g),t.bezierCurveTo(f,g+l,d+h,s,d,s),t.bezierCurveTo(d-h,s,o,g+l,o,g),U(t),!0},image:function(t,e,n,i){var r=w(n,e),o=m(n,e);P(t,o);var a=new Image;a.onload=function(){if("cover"===n.fit){var e=r.width/r.height,o=e>1?a.width:a.height*e,u=e>1?a.width/e:a.height,c=.5*a.width-.5*o,h=.5*a.height-.5*u;t.drawImage(a,c,h,o,u,r.x,r.y,r.width,r.height)}else if("contain"===n.fit){var l=Math.min(r.width/a.width,r.height/a.height),f=l*a.width,s=l*a.height,d=r.x+.5*r.width-.5*f,g=r.y+.5*r.height-.5*s;t.drawImage(a,0,0,a.width,a.height,d,g,f,s)}else t.drawImage(a,0,0,a.width,a.height,r.x,r.y,r.width,r.height);U(t),i()},a.src=n.src},text:function(t,e,n){var i=w(n,e),r=m(n,e);P(t,r);var o=v(n.fontSize,e),a=n.fontFamily||"sans-serif",u=n.fontWeight||"normal",c=n.textAlign||"left";return t.font="".concat(u," ").concat(o,"px ").concat(a),t.textAlign=c,t.fillText(n.text,i.x,i.y),U(t),!0},line:function(t,e,n){var i=w(n,e),r=m(n,e);P(t,r),t.beginPath();var o={x:i.x,y:i.y},a={x:i.x+i.width,y:i.y+i.height};t.moveTo(o.x,o.y),t.lineTo(a.x,a.y);var u=d({x:a.x-o.x,y:a.y-o.y}),c=.04*Math.min(e.width,e.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){var h=f(u,c),l=s(o,h),y=g(o,2,l),v=g(o,-2,l);t.moveTo(y.x,y.y),t.lineTo(o.x,o.y),t.lineTo(v.x,v.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){var p=f(u,-c),x=s(a,p),M=g(a,2,x),T=g(a,-2,x);t.moveTo(M.x,M.y),t.lineTo(a.x,a.y),t.lineTo(T.x,T.y)}return U(t),!0}},F=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,r){if(!t||!function(t){return/^image/.test(t.type)}(t))return r();var o=n.stripImageHead,h=n.beforeCreateBlob,f=n.afterCreateBlob,s=n.canvasMemoryLimit,d=e.crop,g=e.size,y=e.filter,v=e.markup,m=e.output,p=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,w=m&&m.quality,x=null===w?null:w/100,M=m&&m.type||null,T=[];!g||"number"!=typeof g.width&&"number"!=typeof g.height||T.push({type:"resize",data:g}),y&&20===y.length&&T.push({type:"filter",data:y});var b=function(t){var e=f?f(t):t;Promise.resolve(e).then(i)},A=function(t,e){var n=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e}(t),i=v.length?B(n,v):n;Promise.resolve(i).then(function(t){(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){var r=n?n(t):t;Promise.resolve(r).then(function(t){t.toBlob(i,e.type,e.quality)})})})(t,e,h).then(function(t){if(o)return b(t);S(t).then(function(e){null!==e&&(t=new Blob([e,t.slice(20)],{type:t.type})),b(t)})}).catch(r)})};if(/svg/.test(t.type)&&null===M)return I(t,d,v).then(function(t){i(C(t,"image/svg+xml"))});var E=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=function(t){n(t)},i.src=t})})(E).then(function(e){URL.revokeObjectURL(E);var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).canvasMemoryLimit,r=n.zoom||1,o=l(t,e,n.flip),h={width:o.width,height:o.height},f=n.aspectRatio||h.height/h.width,s=c(h,f,r);if(i){var d=s.width*s.height;if(d>i){var g=Math.sqrt(i)/Math.sqrt(d);h.width=Math.floor(h.width*g),h.height=Math.floor(h.height*g),s=c(h,f,r)}}var y=document.createElement("canvas"),v={x:.5*s.width,y:.5*s.height},m={x:0,y:0,width:s.width,height:s.height,center:v},p=r*a(h,u(m,f),n.rotation,n.center);y.width=Math.round(s.width/p),y.height=Math.round(s.height/p),v.x/=p,v.y/=p;var w=v.x-h.width*(n.center?n.center.x:.5),x=v.y-h.height*(n.center?n.center.y:.5),M=y.getContext("2d");return M.translate(v.x,v.y),M.rotate(n.rotation||0),M.drawImage(o,w-v.x,x-v.y,h.width,h.height),M.getImageData(0,0,y.width,y.height)}(e,p,d,{canvasMemoryLimit:s}),i={quality:x,type:M||t.type};if(!T.length)return A(n,i);var r=L(R);r.post({transforms:T,imageData:n},function(t){A(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),i),r.terminate()},[n.data.buffer])})})};function G(t){this.wrapped=t}function z(t){var e,n;function i(e,n){try{var o=t[e](n),a=o.value,u=a instanceof G;Promise.resolve(u?a.wrapped:a).then(function(t){u?i("next",t):r(o.done?"return":"normal",t)},function(t){i("throw",t)})}catch(t){r("throw",t)}}function r(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new Promise(function(o,a){var u={key:t,arg:r,resolve:o,reject:a,next:null};n?n=n.next=u:(e=n=u,i(t,r))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(z.prototype[Symbol.asyncIterator]=function(){return this}),z.prototype.next=function(t){return this._invoke("next",t)},z.prototype.throw=function(t){return this._invoke("throw",t)},z.prototype.return=function(t){return this._invoke("return",t)};function j(t,e){return D(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}return n}(t,e)||q()}function D(t){if(Array.isArray(t))return t}function q(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var H=["x","y","left","top","right","bottom","width","height"],V=function(t){var e=j(t,2),n=e[0],i=e[1];return[n,Object.assign({zIndex:0},i,H.reduce(function(t,e){var n;return t[e]="string"==typeof(n=i[e])&&/%/.test(n)?parseFloat(n)/100:n,t},{}))]};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this;setTimeout(function(){for(var r=i.toDataURL(e,n).split(",")[1],o=atob(r),a=o.length,u=new Uint8Array(a);a--;)u[a]=o.charCodeAt(a);t(new Blob([u],{type:e||"image/png"}))})}}));var W="undefined"!=typeof window&&void 0!==window.document,Y=W&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,J=function(e){var n=e.addFilter,i=e.utils,r=i.Type,o=i.forin,a=i.getFileFromBlob,u=i.isFile,c=["crop","resize","filter","markup","output"],h=function(t){return null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical};return n("SHOULD_PREPARE_OUTPUT",function(t,e){var n=e.query;return new Promise(function(t){t(!n("IS_ASYNC"))})}),n("PREPARE_OUTPUT",function(e,n){var i=n.query,r=n.item;return new Promise(function(n){if(!u(e)||!function(t){return/^image/.test(t.type)}(e)||!i("GET_ALLOW_IMAGE_TRANSFORM")||r.archived)return n(e);var l=[];i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&l.push(function(){return new Promise(function(t){t({name:i("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:e})})}),i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&l.push(function(t,e,n){return new Promise(function(r){t(e,n).then(function(t){return r({name:i("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})})})});var f=i("GET_IMAGE_TRANSFORM_VARIANTS")||{};o(f,function(t,e){var n,i=(n=e,function(t,e,i){return t(e,n?n(i):i)});l.push(function(e,n,r){return new Promise(function(o){i(e,n,r).then(function(e){return o({name:t,file:e})})})})});var s=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),d=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),g=null===s?null:s/100,y=i("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),v=i("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||c;r.setMetadata("output",{type:y,quality:g,client:v},!0);var m=function(e,n){return new Promise(function(r,o){var u=Object.assign({},n);Object.keys(u).filter(function(t){return"exif"!==t}).forEach(function(t){-1===v.indexOf(t)&&delete u[t]});var c=u.resize,l=u.exif,f=u.output,s=u.crop,g=u.filter,y=u.markup,m={image:{orientation:l?l.orientation:null},output:f?{type:f.type,quality:f.quality?100*f.quality:null}:void 0,size:c&&(c.size.width||c.size.height)?Object.assign({mode:c.mode,upscale:c.upscale},c.size):void 0,crop:s&&!h(s)?Object.assign({},s):void 0,markup:y&&y.length?y.map(V):[],filter:g};if(m.output){var p=f.type&&f.type!==e.type,w=!!(m.size||m.crop||m.filter||p);if(f.quality&&"optional"===d&&!w)return r(e)}var x={beforeCreateBlob:i("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:i("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:i("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:i("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};F(e,m,x).then(function(n){var i,o=a(n,function(e,n){var i=function(t){return t.substr(0,t.lastIndexOf("."))||t}(e),r=n.split("/")[1],o=t[r]||r;return"".concat(i,".").concat(o)}(e.name,(i=n.type,/jpeg|png|svg\+xml/.test(i)?i:"image/jpeg")));r(o)}).catch(o)})},p=l.map(function(t){return t(m,e,r.getMetadata())});Promise.all(p).then(function(t){n(1===t.length&&null===t[0].name?t[0].file:t)})})}),{options:{allowImageTransform:[!0,r.BOOLEAN],imageTransformOutputMimeType:[null,r.STRING],imageTransformOutputQuality:[null,r.INT],imageTransformOutputStripImageHead:[!0,r.BOOLEAN],imageTransformClientTransforms:[null,r.ARRAY],imageTransformOutputQualityMode:["always",r.STRING],imageTransformVariants:[null,r.OBJECT],imageTransformVariantsIncludeDefault:[!0,r.BOOLEAN],imageTransformVariantsDefaultName:[null,r.STRING],imageTransformVariantsIncludeOriginal:[!1,r.BOOLEAN],imageTransformVariantsOriginalName:["original_",r.STRING],imageTransformBeforeCreateBlob:[null,r.FUNCTION],imageTransformAfterCreateBlob:[null,r.FUNCTION],imageTransformCanvasMemoryLimit:[W&&Y?16777216:null,r.INT]}}};return W&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:J})),J});
